<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheWebspider | Premium Monitoring</title>
    <link rel="stylesheet" href="/src/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body class="dark-mode">
    <!-- Landing Page / Login Overlay -->
    <div id="login-overlay" class="landing-page overlay">
        <div class="interactive-bg-logo" id="interactive-bg-logo"></div>
        <div class="landing-content animate-fade-in text-center">
            <div class="logo-large mb-2">
                <img src="/spider-bg-logo.png" alt="TheWebspider Logo"
                    style="width: 90px; height: 90px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);">
            </div>
            <h1 class="hero-title">TheWebspider</h1>
            <p class="hero-subtitle mb-4">Professional Web Monitoring & AI Diff Summarization.</p>

            <div class="features-grid mb-4">
                <div class="feature-box">
                    <h3>üéØ AI Trigger Alerts</h3>
                    <p>Stop reading HTML diffs. Set specific conditions and only get notified when your exact criteria
                        are met.</p>
                </div>
                <div class="feature-box">
                    <h3>‚è±Ô∏è Custom Frequencies</h3>
                    <p>Choose between High Priority (15m), Daily, or Weekly checks to optimize resources.</p>
                </div>
                <div class="feature-box security-box">
                    <h3>üï∑Ô∏è Deep Crawl & Visual Diff</h3>
                    <p>Recursively scan sub-directories and receive visual screenshot evidence alongside text updates.
                    </p>
                </div>
            </div>

            <div class="auth-section">
                <p class="text-secondary mb-2">Securely authenticate to access your dashboard</p>
                <div id="google-login-btn"></div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <header class="main-header glass animate-slide-down" style="display: none;">
        <div class="container d-flex justify-between align-center">
            <div class="logo">üï∏Ô∏è WebWatcher</div>
            <div id="user-actions" style="display: none; align-items: center; gap: 1rem;">
                <span id="user-email-display" class="text-secondary" style="font-size: 0.9rem;"></span>
                <button id="admin-panel-btn" class="btn btn-outline btn-sm"
                    style="display: none; border-color: var(--warning); color: var(--warning);">Admin Panel</button>
                <button id="logout-btn" class="btn btn-outline btn-sm">Sign Out</button>
            </div>
        </div>
    </header>

    <main id="dashboard" class="container py-4" style="display: none;">
        <div class="dashboard-header d-flex justify-between align-center mb-4">
            <div>
                <h2 class="mb-1">Monitored Pages</h2>
                <p id="monitor-count-text" class="text-secondary">You are using 0 of 10 slots.</p>
            </div>
            <button id="add-monitor-btn" class="btn btn-primary">
                <span class="plus-icon">+</span> Add Monitor
            </button>
        </div>

        <div id="monitor-limit-warning" class="alert alert-warning mb-4" style="display: none;">
            ‚ö†Ô∏è You have reached the maximum limit of 10 monitored pages.
        </div>

        <div id="monitors-grid" class="monitors-grid"></div>
    </main>

    <!-- ADMIN DASHBOARD (Hidden by default) -->
    <main id="admin-dashboard" class="container" style="display: none; padding-top: 2rem;">
        <div class="d-flex justify-between align-center mb-4">
            <h2>üëë Admin Dashboard</h2>
            <button id="back-to-app-btn" class="btn btn-outline">Back to App</button>
        </div>

        <div class="admin-stats-grid mb-4">
            <div class="stat-card">
                <h3>Total Users</h3>
                <div class="stat-value" id="admin-total-users">-</div>
            </div>
            <div class="stat-card">
                <h3>Active Monitors</h3>
                <div class="stat-value" id="admin-total-monitors">-</div>
            </div>
            <div class="stat-card" style="border-left: 4px solid var(--danger);">
                <h3>Failed Runs</h3>
                <div class="stat-value text-danger" id="admin-total-failed">-</div>
            </div>
        </div>

        <div class="admin-table-container glass" style="padding: 1rem; border-radius: 8px;">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>User Email</th>
                        <th>Target URL</th>
                        <th>Status</th>
                        <th>Error Msg</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="admin-table-body">
                    <tr>
                        <td colspan="5" class="text-center text-secondary py-4">Loading stats...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Add Monitor Modal -->
    <div id="monitor-modal" class="overlay" style="display: none;">
        <div class="modal-card glass animate-scale-up">
            <div class="modal-header d-flex justify-between align-center mb-3">
                <h3 id="modal-title">Add New TheWebspider</h3>
                <button id="close-modal-btn" class="btn-close">&times;</button>
            </div>
            <form id="add-monitor-form">
                <div class="form-group mb-3">
                    <label for="target-url">üéØ Target URL</label>
                    <input type="url" id="target-url" placeholder="https://example.com/page-to-watch" required>
                </div>

                <div class="form-group mb-3">
                    <label for="check-frequency">‚è±Ô∏è Check Frequency</label>
                    <select id="check-frequency" class="form-control"
                        style="background: #2a2a35; color: white; border: 1px solid var(--border); padding: 12px; border-radius: 8px; width: 100%;">
                        <option value="15" style="background: #2a2a35; color: white;">High Priority (Every 15 mins) -
                            Pro</option>
                        <option value="1440" style="background: #2a2a35; color: white;" selected>Standard (Daily Check)
                        </option>
                        <option value="10080" style="background: #2a2a35; color: white;">Low Priority (Weekly Check)
                        </option>
                    </select>
                </div>

                <div class="form-checkbox-group mb-4"
                    style="background: rgba(99, 102, 241, 0.05); padding: 12px; border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.1);">
                    <label class="checkbox-container" style="margin-bottom: 0;">
                        <input type="checkbox" id="trigger-mode">
                        <span class="checkmark"></span>
                        <span style="font-weight: 600;">üéØ AI Trigger Alert</span>
                    </label>
                    <small class="text-secondary d-block mt-1" style="margin-left: 28px;">If enabled, you will ONLY be
                        notified if the specific condition below is strictly MET (e.g. "Price dropped below
                        $50").</small>

                    <div id="ai-trigger-fields" class="form-sub-section animate-slide-down mt-3"
                        style="display: none; margin-left: 28px;">
                        <textarea id="ai-focus-note" rows="2" class="form-control"
                            placeholder="Type your condition here... E.g., The sneakers are back in stock in size 10"
                            style="width: 100%;"></textarea>
                    </div>
                </div>

                <div class="form-checkbox-group mb-4"
                    style="background: rgba(99, 102, 241, 0.05); padding: 12px; border-radius: 8px; border: 1px solid rgba(99, 102, 241, 0.1);">
                    <label class="checkbox-container">
                        <input type="checkbox" id="visual-mode">
                        <span class="checkmark"></span>
                        üì∏ Enable Visual Screenshots <span class="badge-experimental">New</span>
                    </label>
                    <small class="text-secondary d-block mt-1" style="margin-left: 35px;">Instead of text, capture an
                        image showing the exact visual change.</small>
                </div>

                <div class="form-checkbox-group mb-3">
                    <label class="checkbox-container">
                        <input type="checkbox" id="deep-crawl">
                        <span class="checkmark"></span>
                        Enable Deep Crawl
                        <span class="badge-experimental">Advanced</span>
                    </label>
                </div>

                <div id="deep-crawl-options" class="form-sub-section animate-slide-down mb-3" style="display: none;">
                    <div class="form-group">
                        <label for="deep-crawl-depth">Crawl Depth Limit (1-5)</label>
                        <input type="number" id="deep-crawl-depth" min="1" max="5" value="2"
                            style="width: 100px; padding: 0.5rem; border-radius: 4px; border: 1px solid var(--border-color); background: rgba(0,0,0,0.2); color: white;">
                        <small class="text-secondary d-block mt-1">Level 1 = just the Target URL. Level 2 = Target URL +
                            all links directly on it, etc.</small>
                    </div>
                </div>

                <div id="deep-crawl-alert" class="alert alert-danger mb-3 animate-slide-down" style="display: none;">
                    <strong>HIGH ALERT:</strong> Deep Crawl instructs the bot to recursively click all links on the same
                    domain up to the specified depth. This runs a heavy operation. Use sparingly!
                </div>

                <div class="form-checkbox-group mb-3">
                    <label class="checkbox-container">
                        <input type="checkbox" id="requires-login">
                        <span class="checkmark"></span>
                        Requires Login
                    </label>
                </div>

                <div id="login-fields" class="form-sub-section animate-slide-down" style="display: none;">
                    <div class="form-group mb-2">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Username or Email">
                    </div>
                    <div class="form-group mb-2">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Password">
                    </div>
                </div>

                <div class="form-checkbox-group mb-3">
                    <label class="checkbox-container">
                        <input type="checkbox" id="has-captcha">
                        <span class="checkmark"></span>
                        Has Captcha / Use Cookies
                    </label>
                </div>

                <div id="captcha-fields" class="form-sub-section animate-slide-down" style="display: none;">
                    <div class="form-group mb-2">
                        <label for="captcha-json">Cookies JSON Array</label>
                        <textarea id="captcha-json" rows="4"
                            placeholder='[{"name": "session", "value": "..."}]'></textarea>
                        <small class="text-secondary">Paste a JSON array of cookies for the session.</small>
                    </div>
                </div>

                <div class="form-section-header mb-3"
                    style="border-top: 1px solid var(--border); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <h4
                        style="font-size: 0.9rem; color: var(--primary); text-transform: uppercase; letter-spacing: 1px;">
                        üîî Notifications & Webhooks</h4>
                </div>

                <div class="form-checkbox-group mb-2">
                    <label class="checkbox-container">
                        <input type="checkbox" id="enable-notifications" checked>
                        <span class="checkmark"></span>
                        Email Notifications
                    </label>
                </div>

                <div class="form-checkbox-group mb-3">
                    <label class="checkbox-container">
                        <input type="checkbox" id="enable-telegram">
                        <span class="checkmark"></span>
                        Telegram Alerts
                    </label>
                </div>

                <div id="telegram-fields" class="form-sub-section animate-slide-down mb-4" style="display: none;">
                    <div id="telegram-connect-prompt" class="mb-2">
                        <p class="text-secondary mb-2" style="font-size: 0.9em;">Click below to securely link your
                            Telegram account for instant alerts.</p>
                        <a id="telegram-connect-btn" href="#" target="_blank" class="btn btn-outline btn-block"
                            style="text-decoration:none; text-align:center; display: flex; justify-content: center; align-items: center; gap: 8px; background: rgba(0, 136, 204, 0.1); border-color: rgba(0, 136, 204, 0.3);">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path d="M21 5L2 12.5L9 14M21 5L18.5 20L9 14M21 5L9 14M9 14V19.5L13.5 15.5"
                                    stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" />
                            </svg>
                            Connect Telegram App
                        </a>
                    </div>
                    <div id="telegram-connected-status" class="alert alert-success mb-2" style="display: none;">
                        ‚úÖ Linked successfully!
                    </div>
                    <input type="hidden" id="telegram-chat-id">
                </div>

                <div class="form-checkbox-group mb-3">
                    <label class="checkbox-container">
                        <input type="checkbox" id="enable-webhooks">
                        <span class="checkmark"></span>
                        Enable Discord / Slack Webhooks
                    </label>
                </div>

                <div id="webhook-fields" class="form-group mb-4"
                    style="display: none; background: rgba(88, 101, 242, 0.05); padding: 12px; border-radius: 8px; border: 1px solid rgba(88, 101, 242, 0.2);">
                    <label for="custom-webhook-url" style="display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M19.27 4.73C17.69 3.15 15.58 2.27 13.34 2.27C8.85 2.27 5.21 5.91 5.21 10.4C5.21 11.9 5.61 13.31 6.31 14.51L2.27 21.73H21.73L17.69 14.51C18.39 13.31 18.79 11.9 18.79 10.4C18.79 8.16 17.91 6.05 16.33 4.47L19.27 4.73Z" />
                        </svg>
                        Webhook Destination URL
                    </label>
                    <input type="url" id="custom-webhook-url" placeholder="https://discord.com/api/webhooks/..."
                        style="margin-top: 5px;">
                    <small class="text-secondary d-block mt-1">Paste a webhook URL to receive alerts in Discord or
                        Slack.</small>
                </div>

                <div class="d-flex justify-end">
                    <button type="submit" id="submit-monitor-btn" class="btn btn-primary btn-block">Start
                        Watching</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Deep Crawl Confirmation Modal -->
    <div id="deep-crawl-modal" class="overlay" style="display: none; z-index: 2000;">
        <div class="modal-card glass animate-scale-up"
            style="border: 1px solid var(--danger); box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); max-width: 450px;">
            <div class="modal-header d-flex justify-between align-center mb-3">
                <h3 style="color: var(--danger);">‚ö†Ô∏è Danger Zone</h3>
                <button id="close-deep-crawl-btn" class="btn-close" type="button">&times;</button>
            </div>
            <p class="mb-3">
                <strong>Deep Crawl</strong> instructs the bot to recursively visit all internal links on the website up
                to the specified depth.
            </p>
            <p class="mb-4 text-secondary" style="font-size: 0.95em;">
                Crawling will recursively interact with pages on the target site. This carries a <strong>very
                    high risk of triggering unintended actions</strong>‚Äîsuch as automatically clicking "Delete", "Log
                Out", or submitting forms‚Äîif the bot wanders into interactive elements. Do not use this on authenticated
                dashboards where random clicking could cause permanent data loss!
                <br><br>
                Are you certain you want to enable this high-risk operation?
            </p>
            <div class="d-flex justify-end" style="gap: 12px;">
                <button id="cancel-deep-crawl-btn" type="button" class="btn btn-outline"
                    style="flex: 1;">Cancel</button>
                <button id="confirm-deep-crawl-btn" type="button" class="btn btn-primary"
                    style="background-color: var(--danger); flex: 1;">Yes, Enable</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script type="module" src="/src/main.js"></script>
</body>

</html>